@page "/patients"
@using ClinicalEpilepsyApp.Domain.Models
@using ClinicalEpilepsyApp.Infrastructure.Repositories
@attribute [StreamRendering]

<PageTitle>Patients</PageTitle>

<h1>Patients</h1>

<button class="btn btn-primary" @onclick="AddPatient">Add Patient</button>

@if (patients == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>CSI</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        @foreach (var patient in patients)
        {
            <tr>
                <td>@patient.Id</td>
                <td>@patient.Name</td>
                <td>@patient.CSI</td>
                <td><button class="btn btn-link" @onclick="() => EditPatient(patient)">Edit</button></td>
            </tr>
        }
        </tbody>
    </table>
}

@code {
    private List<Patient> patients;

    private PatientRepository repository;

    protected override async Task OnInitializedAsync()
    {
    // Load patients from the repository
        patients = await repository.GetAllPatientsAsync();
    }

    private void AddPatient()
    {
    // Navigate to the edit page with empty fields
        NavigationManager.NavigateTo("/patients/edit");
    }

    private void EditPatient(Patient patient)
    {
    // Navigate to the edit page with patient details
        NavigationManager.NavigateTo($"/patients/edit/{patient.Id}");
    }
}